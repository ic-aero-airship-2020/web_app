<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Home</title>
    <link rel="stylesheet" href="./style.css" />
    <!-- Load an icon library -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        #left {
            position: absolute;
            left: 0;
            top: 5em;
            height: 100%;
            width: 50%;
            background: rgba(148, 148, 148, 0.5);
        }

        #right {
            position: absolute;
            right: 0;
            top: 5em;
            height: 100%;
            width: 50%;
            background: rgba(158, 158, 158,0.2);
        }
    </style>
  </head>

  <body>
      <header>
          <div id="mySidepanel" class="sidepanel">
              <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
              <a href="index.html"><i class="material-icons">home</i> Home</a>
              <a href="commands.html"><i class="material-icons">record_voice_over</i> Voice Commands</a>
              <a href="joystick.html"><i class="material-icons">speaker</i> Remote Control</a>
              <a href="destinations.html"><i class="material-icons">speaker</i> Destination Request</a>
              <a href="info.html"><i class="material-icons">lightbulb</i> Project Info</a>
              <a href="help.html"><i class="material-icons">help</i> Help</a>
              <a href="report.html"><i class="material-icons">feedback</i> Report</a>
          </div>

          <div id=left></div>
          <div id=right></div>

              <button class="openbtn" onclick="openNav()">&#9776; </button>

              <h1>Remote Control</h1>
      </header>

      <main>
          <script src="virtualjoystick.js"></script>
          <script>
              console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");

              var joystickR = new VirtualJoystick({
                  container: document.body.left,
                  strokeStyle: 'green',
                  limitStickTravel: true,
                  stickRadius: 50
              });

              joystickR.addEventListener('touchStartValidation', function (event) {
                  var touch = event.changedTouches[0];
                  if (touch.pageX < window.innerWidth / 2 & touch.pageY > 80) return true;
                  return false
              });

              var joystickL = new VirtualJoystick({
                  container: document.body.right,
                  strokeStyle: 'purple',
                  limitStickTravel: true,
                  stickRadius: 50
              });

              joystickL.addEventListener('touchStartValidation', function (event) {
                  var touch = event.changedTouches[0];
                  if (touch.pageX >= window.innerWidth / 2 & touch.pageY > 80) return true;
                  return false
              });

              joystickL.addEventListener('touchStart', function () {
                  console.log('fire')
              })
              joystickR.addEventListener('touchStart', function () {
                  console.log('fire')
              })

              document.addEventListener("touchmove", function (e) {
                  e.preventDefault();
              }, { passive: false });

              var dx = 0.00;
              var dy = 0.00;
              var left = "00.00";
              var right = "00.00";

              animate();

              function animate() {
                  requestAnimationFrame(animate);

                  dx = joystickL.deltaX().toFixed(2);
                  dy = -joystickL.deltaY().toFixed(2);

                  if (dx < 0) {
                      dx = Math.abs(dx).toString().concat("1")
                  } else { dx = Math.abs(dx).toString().concat("0") }
                  dx = String("000000" + dx).slice(-6);

                  if (dy < 0) {
                      dy = Math.abs(dy).toString().concat("1")
                  } else { dy = Math.abs(dy).toString().concat("0") }
                  dy = String("000000" + dy).slice(-6);

                  left = dx.concat(dy);

                 

                  dx = joystickR.deltaX().toFixed(2);
                  dy = -joystickR.deltaY().toFixed(2);

                  if (dx < 0) {
                      dx = Math.abs(dx).toString().concat("1")
                  } else { dx = Math.abs(dx).toString().concat("0") }
                  dx = String("000000" + dx).slice(-6);

                  if (dy < 0) {
                      dy = Math.abs(dy).toString().concat("1")
                  } else { dy = Math.abs(dy).toString().concat("0") }
                  dy = String("000000" + dy).slice(-6);

                  right = dx.concat(dy);
              }

          </script>
      </main>

    <footer>
      <p>Imperial College London</p>
    </footer>

    <script type="text/javascript" src="./scripts/joystick.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
    <script src="/__/firebase/7.14.5/firebase-database.js"></script>

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyDf4XsjHsXLWF62d53Ju6RGfgvTmQAnWRc",
        authDomain: "airship-a31a9.firebaseapp.com",
        databaseURL: "https://airship-a31a9.firebaseio.com",
        projectId: "airship-a31a9",
        storageBucket: "airship-a31a9.appspot.com",
        messagingSenderId: "72145400100",
        appId: "1:72145400100:web:c72b6ee1af04aee2cec3b1"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
    </script>
  </body>
</html>
